<ion-header>
  <ion-toolbar>
    <ion-title size="large" color="warning">Coefficients</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [class.ouplc-theme]="pointsSelected === 'Blues'">
  <ion-grid>
    <ion-row>
        <ion-col [attr.size-md]="pointsSelected!=='Blues' ? 12 : 6">
          <ion-card>
            <form #coeff="ngForm">
              <ion-card-header>
                <ion-card-title *ngIf="pointsSelected!=='Blues'">{{ pointsSelected }}</ion-card-title>
                <ion-card-title *ngIf="pointsSelected==='Blues'">
                  <ion-row class="ion-align-items-center">
                    <ion-col class="ion-no-padding">
                      Oxford {{ pointsSelected }}
                    </ion-col>
                    <ion-col class="ion-no-padding" size="auto">
                      <ion-buttons>
                        <ion-button (click)="presentPopover($event)">
                          <ion-icon name="help-circle"></ion-icon>
                        </ion-button>
                      </ion-buttons>
                    </ion-col>
                  </ion-row>
                </ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-label position="fixed">Gender</ion-label>
                <ion-segment
                  [(ngModel)]="userGender"
                  [ngModelOptions]="{standalone: true}"
                  (ionChange)="onChangeGender(coeff); calcResult(coeff)"
                >
                  <ion-segment-button value="male">
                    <ion-label>Male</ion-label>
                  </ion-segment-button>
                  <ion-segment-button value="female">
                    <ion-label>Female</ion-label>
                  </ion-segment-button>
                </ion-segment>
                <br/>
                <ion-label position="fixed">Point system</ion-label>
                <ion-select
                  [(ngModel)]="pointsSelected"
                  [ngModelOptions]="{standalone: true}"
                  (ngModelChange)="calcResult(coeff)"
                  interface="popover"
                >
                  <ion-select-option value="IPF GL">IPF GL</ion-select-option>
                  <ion-select-option value="IPF">IPF</ion-select-option>
                  <ion-select-option value="DOTS">DOTS</ion-select-option>
                  <ion-select-option value="Wilks">Wilks</ion-select-option>
                  <ion-select-option value="Blues">Oxford Blues</ion-select-option>
                </ion-select>
                <br/>
                <ion-segment (ionChange)="segmentChanged($event)" [value]="segmentSelected">
                  <ion-segment-button value="total">
                    <ion-label>Total</ion-label>
                  </ion-segment-button>
                  <ion-segment-button value="threeLifts">
                    <ion-label>SBD</ion-label>
                  </ion-segment-button>
                  <ion-segment-button value="onlyBP">
                    <ion-label>Bench</ion-label>
                  </ion-segment-button>
                </ion-segment>
                <br/>
                <ion-list [inset]="true">
                  <ion-item>
                    <ion-label position="fixed">bodyweight</ion-label>
                    <ion-input
                      type="number"
                      [ngModel]="userBw"
                      name="weight"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                  <ion-item [hidden]="segmentSelected!=='total' || result==='total'">
                    <ion-label position="fixed">total</ion-label>
                    <ion-input
                      type="number"
                      [(ngModel)]="userTotal"
                      name="total"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                  <ion-item *ngIf="pointsSelected!=='Blues'" [hidden]="result==='points'">
                    <ion-label position="fixed">points</ion-label>
                    <ion-input
                      type="number"
                      [(ngModel)]="userPoints"
                      name="points"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                  </ion-item>
                  <ion-item [hidden]="segmentSelected!=='threeLifts'">
                    <ion-label position="fixed">squat</ion-label>
                    <ion-input
                      type="number"
                      [ngModel]="userSq"
                      name="sq"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                  <ion-item [hidden]="segmentSelected!=='threeLifts'">
                    <ion-label position="fixed">bench</ion-label>
                    <ion-input
                      type="number"
                      [ngModel]="userBp"
                      name="bp"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                  <ion-item [hidden]="segmentSelected!=='threeLifts'">
                    <ion-label position="fixed">deadlift</ion-label>
                    <ion-input
                      type="number"
                      name="dl"
                      [ngModel]="userDl"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                  <ion-item [hidden]="segmentSelected!=='onlyBP'">
                    <ion-label position="fixed">bench</ion-label>
                    <ion-input
                      type="number"
                      [ngModel]="userBp"
                      name="bp"
                      (ngModelChange)="calcResult(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                </ion-list>
                <ion-row [hidden]="segmentSelected!=='threeLifts'" class="ion-justify-content-end ion-margin-top">
                  = {{ userTotal || 0 }}{{ weightUnitService.userUnit | async }} total
                </ion-row>
                <br/>
                <ion-row class="ion-align-items-center" *ngIf="pointsSelected!=='Blues' else bluesBlock">
                  <ion-col id="result" *ngIf="result==='points'">
                    <ion-text class="ion-padding-end" color="success">
                      {{ (userPoints | number : '1.2-2') || '0.00' }}
                    </ion-text> {{ pointsSelected }} points
                  </ion-col>
                  <ion-col id="result" *ngIf="result==='total'">
                    <ion-text color="success">
                      {{ (userTotal | number : '1.2-2') || '0.00' }}{{ weightUnitService.userUnit | async }}
                    </ion-text> total
                  </ion-col>
                  <ion-col
                    class="ion-text-end ion-no-padding"
                    size="auto"
                    [hidden]="segmentSelected!=='total'">
                    <ion-buttons>
                      <ion-button (click)="onSwitch()">
                        <ion-icon name="swap-vertical"></ion-icon>
                      </ion-button>
                    </ion-buttons>
                  </ion-col>
                </ion-row>
                <ng-template #bluesBlock>
                  <ion-row id="result">
                    <ion-text class="ion-padding-end" id="blues">
                      {{ userPoints || 'None' }}
                    </ion-text> achieved
                  </ion-row>
                </ng-template>
              </ion-card-content>
            </form>
          </ion-card>
        </ion-col>

        <ion-col size-md="6" *ngIf="pointsSelected==='Blues'">
          <ion-card>
            <form #coeff="ngForm">
              <ion-card-header>
                <ion-card-title id="blues">Blues Goal Toggle</ion-card-title>
                <ion-card-subtitle>
                  Calculate what you need to total to obtain your goal Blues certification.
                </ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <ion-list [inset]="true">
                  <ion-item>
                    <ion-label position="fixed">bodyweight</ion-label>
                    <ion-input
                      type="number"
                      ngModel
                      name="goalBw"
                      (ionChange)="calcGoal(coeff)"
                    ></ion-input>
                    <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                  </ion-item>
                </ion-list>
                <ion-label position="fixed">Goal</ion-label>
                <ion-segment
                  [(ngModel)]="goalBlue"
                  name="goalBlue"
                  (ionChange)="calcGoal(coeff); calcDelta(coeff)"
                >
                  <ion-segment-button value="full">
                    <ion-label>Full Blue</ion-label>
                  </ion-segment-button>
                  <ion-segment-button value="half">
                    <ion-label>Half Blue</ion-label>
                  </ion-segment-button>
                </ion-segment>
                <br/>

                <ion-row class="ion-align-items-center" (click)="onClickCalc()">
                  <ion-col size="auto">
                    <ion-buttons>
                      <ion-button [hidden]="calcDiff" id="blues">
                        <ion-icon size="large" name="add-circle"></ion-icon>
                      </ion-button>
                      <ion-button [hidden]="!calcDiff" id="blues">
                        <ion-icon size="large" name="close-circle"></ion-icon>
                      </ion-button>
                    </ion-buttons>
                  </ion-col>
                  <ion-col>
                    <ion-note>Calculate how far you are away from your goal</ion-note>
                  </ion-col>
                </ion-row>
                <div [hidden]="!calcDiff">
                  <ion-list [inset]="true">
                    <ion-item>
                      <ion-label position="fixed">total</ion-label>
                      <ion-input
                        type="number"
                        ngModel
                        name="tTotal"
                        (ionChange)="calcDelta(coeff)"
                      ></ion-input>
                      <ion-note slot="end">{{ weightUnitService.userUnit | async }}</ion-note>
                    </ion-item>
                  </ion-list>
                  <ion-row
                    class="ion-justify-content-end ion-padding-top"
                    [hidden]="goalBlue!=='half' || !coeff.value.tTotal || !coeff.value.goalBw"
                  >
                    Half Blue: {{ hBlueDiff }}
                  </ion-row>
                  <ion-row
                    class="ion-justify-content-end ion-padding-top"
                    [hidden]="goalBlue!=='full' || !coeff.value.tTotal || !coeff.value.goalBw"
                  >
                    Full Blue: {{ blueDiff }}
                  </ion-row>
                </div>
                <br/>
                <ion-row id="result">
                  Goal total
                  <ion-text class="ion-padding-start" color="warning">
                    {{ (goalTotal | number : '1.2-2') || 0 }}{{ weightUnitService.userUnit | async }}
                  </ion-text>
                </ion-row>
              </ion-card-content>
            </form>
          </ion-card>
        </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
